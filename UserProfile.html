<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"> -->
<link rel="stylesheet" href="css/main.min.css">
<style>
        @import url('https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&display=swap');
        body {
            font-family: 'Lexend', serif;
        }
        .card {
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .card:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }
        .navbar-toggler {
            border: none;
        }

        .navbar-toggler-icon {
            background-color: transparent;
          }
        .navbar-toggler:focus {
            box-shadow: none;
        }

        .navbar-toggler-icon::before,
        .navbar-toggler-icon::after {
            background-color: white;
        }

        .navbar-toggler-icon {
            background-image: none;
        }

        .navbar-toggler-icon::before,
        .navbar-toggler-icon::after {
            content: '';
            display: block;
            width: 30px;
            height: 3px;
            background-color: white;
            margin: 6px 0;
        }
        
    </style>
    <script src="log.js"></script>
</head>
<body>
    <nav class="navbar navbar-light bg-light" style="background-image: linear-gradient( 89.7deg,  rgba(0,0,0,1) -10.7%, rgba(53,92,125,1) 88.8% );" id="home">
        <div class="container-fluid">
            <a class="navbar-brand" href="HomePage.html">
                <img src="/Assets/M (1) - Copy.png" alt="" width="70" height="80" class="d-inline-block align-text-center">
                <span class="text-light">Mobi-Comm</span>
            </a>
            
            <!-- Profile Icon with Dropdown -->
            <div class="dropdown ms-auto">
                <a href="#" class="text-light text-center text-decoration-none dropdown-toggle" id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16">
                        <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>
                        <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1"/>
                    </svg>
                </a>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">
                    <li><a class="dropdown-item" href="HomePage.html">Return to Home</a></li>
                    <li><a class="dropdown-item" href="#" id="logoutBtn">Logout</a></li>
                </ul>
            </div>
            <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasDarkNavbar" aria-controls="offcanvasDarkNavbar" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="offcanvas offcanvas-end text-bg-light" tabindex="-1" id="offcanvasDarkNavbar" aria-labelledby="offcanvasDarkNavbarLabel">
                <div class="offcanvas-header">
                    <h5 class="offcanvas-title" id="offcanvasDarkNavbarLabel">Contents</h5>
                    <button type="button" class="btn-close btn-close-dark" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body">
                    <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="HomePage.html">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/plans.html">All Plans</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" class="text-light" data-bs-toggle="dropdown" aria-expanded="false">
                                Contact Us!
                            </a>
                            <ul class="dropdown-menu dropdown-menu-light">
                                <li><a class="dropdown-item text-dark" href="#"><b>E-mail: </b>Mobicom@tele.ac.in</a></li>
                                <li><a class="dropdown-item text-dark" href="#"><b>Customer Care: </b>1-800-555-1212</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>
    <div class="container mt-5">
        <h2 class="text-center mb-4">User Profile</h2>

        <!-- User Details Card -->
        <div class="card mb-4">
            <div class="card-body">
                <h4 class="card-title">User Details</h4>
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>Name:</strong> <span id="user-name">Loading...</span></p>
                        <p><strong>Mobile Number:</strong> <span id="user-mobile">Loading...</span></p>
                        <p><strong>Email:</strong> <span id="user-email">Loading...</span></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Current Plan Section -->
        <div class="card mb-4">
            <div class="card-body">
                <h4 class="card-title">Current Plan</h4>
                <p id="current-plan" class="card-text">Loading...</p>
                <p id="plan-status" class="text-info"></p>
            </div>
        </div>

        <!-- Recharge History Section -->
        <div class="card mb-4">
            <div class="card-body">
                <h4 class="card-title">Recharge History</h4>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Plan</th>
                            <th>Date</th>
                            <th>Payment Mode</th>
                        </tr>
                    </thead>
                    <tbody id="recharge-history">
                        <!-- Recharge history will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Edit Email Section -->
        <div class="card mb-4">
            <div class="card-body">
                <h4 class="card-title">Edit Email</h4>
                <form id="edit-email-form">
                    <div class="mb-3">
                        <label for="email" class="form-label">Email Address</label>
                        <input type="email" class="form-control" id="email" required>
                    </div>
                    <button type="submit" class="btn btn-gradient text-light w-auto ps-4 pe-4 mt-3 mb-3 rounded-pill">Update Email</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Fetch logged-in user data from localStorage
        const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));

        if (!loggedInUser) {
            // If no user is logged in, redirect to the login page
            alert('You are not logged in. Redirecting to the login page.');
            window.location.href = "UserLogin.html";
        } else {
            // Display user details
            document.getElementById('user-name').textContent = loggedInUser.name;
            document.getElementById('user-mobile').textContent = loggedInUser.mobile;
            document.getElementById('user-email').textContent = loggedInUser.email;

            // Display current plan
            const currentPlanElement = document.getElementById('current-plan');
            const planStatusElement = document.getElementById('plan-status');
            currentPlanElement.textContent = `${loggedInUser.plan} (Expires on: ${loggedInUser.expiry})`;

            const currentDate = new Date();
            const expiryDate = new Date(loggedInUser.expiry);

            if (expiryDate < currentDate) {
                planStatusElement.textContent = "Your plan has expired. Please recharge!";
            } else {
                planStatusElement.textContent = "Your plan is active.";
            }

            // Display recharge history
            const rechargeHistoryElement = document.getElementById('recharge-history');
            loggedInUser.rechargeHistory.forEach(record => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${record.plan}</td>
                    <td>${record.date}</td>
                    <td>${record.payment}</td>
                `;
                rechargeHistoryElement.appendChild(row);
            });

            // Update Email Form
            document.getElementById('edit-email-form').addEventListener('submit', function(event) {
                event.preventDefault();
                const newEmail = document.getElementById('email').value;
                loggedInUser.email = newEmail;
                localStorage.setItem('loggedInUser', JSON.stringify(loggedInUser));
                document.getElementById('user-email').textContent = newEmail;
                alert('Email updated successfully!');
            });
        }

        document.getElementById('logoutBtn').addEventListener('click', function() {
            localStorage.removeItem('loggedInUser'); // Clear user data
            window.location.href = "HomePage.html"; // Redirect to homepage
        });
    </script>
        <script src="log.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>